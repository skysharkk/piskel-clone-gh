!function(t){var e={};function a(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=t,a.c=e,a.d=function(t,e,s){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(s,r,function(e){return t[e]}.bind(null,r));return s},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=5)}([function(t,e,a){"use strict";var s,r=function(){return void 0===s&&(s=Boolean(window&&document&&document.all&&!window.atob)),s},i=function(){var t={};return function(e){if(void 0===t[e]){var a=document.querySelector(e);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(t){a=null}t[e]=a}return t[e]}}(),n={};function o(t,e,a){for(var s=0;s<e.length;s++){var r={css:e[s][1],media:e[s][2],sourceMap:e[s][3]};n[t][s]?n[t][s](r):n[t].push(v(r,a))}}function c(t){var e=document.createElement("style"),s=t.attributes||{};if(void 0===s.nonce){var r=a.nc;r&&(s.nonce=r)}if(Object.keys(s).forEach((function(t){e.setAttribute(t,s[t])})),"function"==typeof t.insert)t.insert(e);else{var n=i(t.insert||"head");if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(e)}return e}var l,d=(l=[],function(t,e){return l[t]=e,l.filter(Boolean).join("\n")});function u(t,e,a,s){var r=a?"":s.css;if(t.styleSheet)t.styleSheet.cssText=d(e,r);else{var i=document.createTextNode(r),n=t.childNodes;n[e]&&t.removeChild(n[e]),n.length?t.insertBefore(i,n[e]):t.appendChild(i)}}function h(t,e,a){var s=a.css,r=a.media,i=a.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),i&&btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleSheet)t.styleSheet.cssText=s;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(s))}}var m=null,f=0;function v(t,e){var a,s,r;if(e.singleton){var i=f++;a=m||(m=c(e)),s=u.bind(null,a,i,!1),r=u.bind(null,a,i,!0)}else a=c(e),s=h.bind(null,a,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(a)};return s(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;s(t=e)}else r()}}t.exports=function(t,e,a){return(a=a||{}).singleton||"boolean"==typeof a.singleton||(a.singleton=r()),t=a.base?t+a.base:t,e=e||[],n[t]||(n[t]=[]),o(t,e,a),function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){n[t]||(n[t]=[]),o(t,e,a);for(var s=e.length;s<n[t].length;s++)n[t][s]();n[t].length=e.length,0===n[t].length&&delete n[t]}}}},function(t,e,a){var s=a(0),r=a(2);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var i={insert:"head",singleton:!1},n=(s(t.i,r,i),r.locals?r.locals:{});t.exports=n},function(t,e,a){},function(t,e,a){var s=a(0),r=a(4);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var i={insert:"head",singleton:!1},n=(s(t.i,r,i),r.locals?r.locals:{});t.exports=n},function(t,e,a){},function(t,e,a){"use strict";a.r(e);a(1),a(3);class s{constructor(){this.isDrawing=!1,this.initialX=null,this.initialY=null,this.currentColor=document.querySelector(".color--input-current"),this.canvas=document.querySelector(".canvas"),this.tool=document.querySelector(".action--pencil")}setInitialCoordinate(t){const e=this.getPixelSize();this.isDrawing=!0,this.initialX=Math.floor(t.offsetX/e),this.initialY=Math.floor(t.offsetY/e)}draw(t){const e=this.getPixelSize();this.isDrawing&&this.tool.classList.contains("active")&&(this.drawAlgorithm(this.initialX,this.initialY,Math.floor(t.offsetX/e),Math.floor(t.offsetY/e),this.currentColor.value),this.initialX=Math.floor(t.offsetX/e),this.initialY=Math.floor(t.offsetY/e))}doneDraw(){this.isDrawing=!1}drawPix(t,e,a){const s=this.getPixelSize(),r=this.canvas.getContext("2d");r.fillStyle=a,r.fillRect(t*s,e*s,s,s)}drawAlgorithm(t,e,a,s,r){const i=Math.abs(a-t),n=Math.abs(s-e),o=t<a?1:-1,c=e<s?1:-1;let l=i-n,d=t,u=e,h=!0;for(;h;){this.drawPix(d,u,r);const t=2*l;d===a&&u===s?h=!1:(t>-n&&(l-=n,d+=o),t<i&&(l+=i,u+=c))}}getPixelSize(){return this.canvas.dataset.size*document.querySelector(".input--radio:checked").value}}function r(t){const e=function(t){return function(t){let e=t.reduce((t,e,a)=>{if(a<=2){let a=e.toString(16);return 1===a.length&&(a=`0${a}`),t+a}return t},"");return e=`#${e}`,e}(document.querySelector(".canvas").getContext("2d").getImageData(t.offsetX,t.offsetY,1,1).data)}(t),a=document.querySelector(".color--input-current"),s=document.querySelector(".color--input-prev");if(a.value!==e){const t=a.value;a.value=e,s.value=t}}function i(t,e){const a=document.querySelectorAll(".action--button"),s=document.querySelector("body");a.forEach(t=>t.classList.remove("active")),t.classList.toggle("active"),Array.from(s.classList).forEach(t=>{s.classList.remove(t)}),s.classList.add(e)}function n(t){const e=document.querySelector(".canvas"),a=document.querySelectorAll(".size_switcher--button"),{size:s}=t.dataset;a.forEach(t=>{t.classList.remove("active")}),t.classList.add("active"),e.dataset.size=s}class o{constructor(t){this.ctx=t.getContext("2d"),this.imageData=this.ctx.getImageData(0,0,t.width,t.height),this.fillStack=[],this.AMOUNT_OF_COLORS=4}floodFill(t,e,a){if(!o.colorMatching(e,a)){const s=this.getPixel(t);o.colorMatching(s,e)&&(this.setPixel(t,a),this.fillStack.push([{x:t.x+1,y:t.y},e,a]),this.fillStack.push([{x:t.x-1,y:t.y},e,a]),this.fillStack.push([{x:t.x,y:t.y+1},e,a]),this.fillStack.push([{x:t.x,y:t.y-1},e,a]))}}fillColor(){const t=this.fillStack.length;this.fillStack.length?(this.fillStack.forEach(t=>{this.floodFill(...t)}),this.clearFillStack(t),this.fillColor()):(this.ctx.putImageData(this.imageData,0,0),this.clearFillStack(this.fillStack.length))}static colorMatching(t,e){return t.join(",")===e.join(",")}clearFillStack(t){this.fillStack.splice(0,t)}setPixel(t,e){const{data:a,width:s}=this.imageData,r=(t.y*s+t.x)*this.AMOUNT_OF_COLORS;[a[r],a[r+1],a[r+2],a[r+3]]=e}getPixel(t){const e=(t.y*this.imageData.width+t.x)*this.AMOUNT_OF_COLORS;return[this.imageData.data[e],this.imageData.data[e+1],this.imageData.data[e+2],this.imageData.data[e+3]]}}class c{constructor(t,e,a){this.position=t,this.dataURL=e,this.drawImage=a}createFrame(){const t=document.createElement("li"),e=document.createElement("canvas");return e.width=128,e.height=128,e.classList.add("canvas_frame",`canvas_frame_${this.position}`),e.dataset.position=this.position,this.addData(e),t.classList.add("frames_list--item",`frame_${this.position}`),t.dataset.position=this.position,t.draggable="true",t.innerHTML=`\n        <div class="frames_list--buttons">\n          <div class="buttons--item buttons--item-text">${this.position+1}</div>\n          <button class="buttons--item" title="Delete this frame" data-type="delete"><i class="fas fa-trash-alt"></i></button>\n          <div class="buttons--item" data-type="drag"><i class="fas fa-arrows-alt buttons--item-icon"></i></div>\n          <button class="buttons--item" title="Duplicate this frame" data-type="copy"><i class="fas fa-copy"></i></button>\n        </div>\n    `,t.appendChild(e),t}async addData(t){await this.drawImage(t,this.dataURL)}}async function l(t,e){const a=t.getContext("2d"),s=await(r=e,new Promise((t,e)=>{const a=new Image;a.src=r,a.crossOrigin="anonymous",a.onload=()=>t(a),a.onerror=()=>e(new Error(`Error loading img ${r}`))}));var r;a.drawImage(s,0,0,t.width,t.height)}let d,u;function h(t){d=t.target.closest(".frames_list--item"),d.classList.add("drag_opacity")}function m(t){d!==t.target.closest(".frames_list--item")&&(t.target.closest(".frames_list--item").classList.add("over"),u=t.target.closest(".frames_list--item"))}function f(t){t.stopPropagation(),t.target.closest(".frames_list--item")!==u&&t.target.closest(".frames_list--item").classList.remove("over")}function v(t){return t.preventDefault(),!1}function g(){const t=document.querySelectorAll(".frames_list--item");Array.prototype.call(t,t=>{t.classList.remove("over")})}class S{constructor(t,e,a){this.position=t,this.frame=document.querySelector(`.frame_${this.position}`),this.frameStack=e,this.activateFrame=a}addEvents(){const t=document.querySelectorAll(".frames_list--item");Array.prototype.forEach.call(t,t=>{this.addEventsDragAndDrop(t,this.dragFrame)})}reRenderFrames(){const t=document.querySelector(".frames_list"),e=document.createDocumentFragment();this.frameStack.forEach((t,a)=>{const s=new c(a,t.dataURL,l);e.appendChild(s.createFrame())}),t.innerHTML="",t.appendChild(e),this.addEvents()}deleteFrame(t){if(this.frameStack.length>1){const e=this.frameStack.splice(this.position,1);this.reRenderFrames();const a=document.querySelector(`.frame_${t-1}`);return this.activateFrame(a),e}return!1}duplicateFrame(){this.frameStack.splice(this.position+1,0,this.frameStack[this.position]),this.reRenderFrames();const t=document.querySelector(`.frame_${this.position+1}`);this.activateFrame(t)}dragFrame(t){const{currentElem:e,newPosition:a}=t,s=this.frameStack.splice(e,1);this.frameStack.splice(a,0,...s),this.reRenderFrames();const r=document.querySelector(`.frame_${a}`);this.activateFrame(r)}addEventsDragAndDrop(t){t.addEventListener("dragstart",h,!1),t.addEventListener("dragenter",m,!1),t.addEventListener("dragover",v,!1),t.addEventListener("dragleave",f,!1),t.addEventListener("drop",t=>{const e=function(t){return t.preventDefault(),d!==t.target.closest(".frames_list--item")&&{currentElem:d.dataset.position,newPosition:t.target.closest(".frames_list--item").dataset.position}}(t);this.dragFrame(e)},!1),t.addEventListener("dragend",g,!1)}}function p(t){document.querySelectorAll(".frames_list--item").forEach(t=>{t.classList.remove("active_frame")}),t.classList.add("active_frame")}const y=document.querySelector(".canvas"),C=document.querySelector(".canvas_layer"),L=document.querySelector(".action--bucket"),w=document.querySelector(".action--grab_color"),k=document.querySelector(".action--pencil"),_=document.querySelector(".action--stroke"),b=document.querySelector(".action--eraser"),D=document.querySelector(".color--input-current"),E=document.querySelector(".color--input-prev"),x=document.querySelector(".size_switcher"),I=document.querySelector(".add_frame_button"),M=document.querySelector(".frames_list"),F=new class{constructor(){this.currentColorInput=document.querySelector(".color--input-current"),this.prevColorInput=document.querySelector(".color--input-prev")}getDefaultColor(t){t.preventDefault(),this.currentColorInput.value!==t.target.value&&(this.prevColor=this.currentColorInput.value,this.currentColorInput.value=t.target.value,this.changePrevColor())}getPreviousColor(t){t.preventDefault(),this.prevColor=this.currentColorInput.value,this.currentColorInput.value=this.prevColorInput.value,this.changePrevColor()}setPrevColor(t){t&&(this.prevColor=t)}changePrevColor(){this.prevColorInput.value=this.prevColor}},A=new s,q=new class extends s{constructor(){super(),this.tool=document.querySelector(".action--eraser")}drawPix(t,e){const a=this.getPixelSize();this.canvas.getContext("2d").clearRect(t*a,e*a,a,a)}},z=new class extends s{constructor(){super(),this.tool=document.querySelector(".action--stroke"),this.strokeCoordinate=[],this.layer=document.querySelector(".canvas_layer"),this.MAX_CANVAS_SIZE=512}draw(t){const e=this.getPixelSize(),a=Math.floor(t.offsetX/e),s=Math.floor(t.offsetY/e);this.isDrawing&&this.tool.classList.contains("active")&&(this.clearLayer(),this.clearStroke(),this.drawAlgorithm(this.initialX,this.initialY,a,s,this.currentColor.value),this.strokeCoordinate.push(this.initialX,this.initialY,a,s,this.currentColor.value))}drawPix(t,e,a){if(this.isDrawing){const s=this.getPixelSize(),r=this.layer.getContext("2d");r.fillStyle=a,r.fillRect(t*s,e*s,s,s)}else super.drawPix(t,e,a)}doneDraw(){this.isDrawing=!1,this.clearLayer(),this.drawAlgorithm(...this.strokeCoordinate)}clearStroke(){this.strokeCoordinate.splice(0,this.strokeCoordinate.length)}clearLayer(){this.layer.getContext("2d").clearRect(0,0,this.MAX_CANVAS_SIZE,this.MAX_CANVAS_SIZE)}disableLayer(){this.layer.classList.add("disable")}activeLayer(){this.layer.classList.remove("disable")}},P=new class{constructor(t){this.frameStack=[],this.canvas=document.querySelector(".canvas"),this.drawImage=t}addFrameData(t){this.frameStack.push(t)}async changeFrameIMG(t,e){const a=document.querySelector(`.canvas_frame_${t}`);this.frameStack[t].dataURL=e,await this.changeCanvasIMG(e,a)}async changeCanvasIMG(t,e){e.getContext("2d").clearRect(0,0,e.width,e.width),await this.drawImage(e,t)}clearMainCanvas(){this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height)}getActiveFrame(){return this.frames=document.querySelectorAll(".frames_list--item"),Array.prototype.findIndex.call(this.frames,t=>t.classList.contains("active_frame"))}}(l),R=new class{constructor(t,e,a,s,r){this.canvas=t,this.layer=e,this.currentColor=a,this.prevColor=s,this.MAX_CANVAS_SIZE=r}setCanvasData(){const t=this.canvas.toDataURL();localStorage.setItem("dataURL",t)}setFrameStack(t){this.frameStack=t,localStorage.setItem("frameStack",JSON.stringify(this.frameStack))}setColor(){localStorage.setItem("currentColor",this.currentColor.value),localStorage.setItem("prevColor",this.prevColor.value)}setCanvasSize(){this.canvasSize=this.canvas.dataset.size,localStorage.setItem("canvasSize",this.canvasSize)}async getCanvasData(){const t=localStorage.getItem("dataURL");t&&await l(this.canvas,t)}getFrameStack(){return this.frameStack=JSON.parse(localStorage.getItem("frameStack")),this.frameStack?this.frameStack:[{dataURL:this.canvas.toDataURL()}]}getColor(){this.currentColor.value=localStorage.getItem("currentColor"),this.prevColor.value=localStorage.getItem("prevColor")}getCanvasSize(){if(localStorage.getItem("canvasSize")){this.canvasSize=Number(localStorage.getItem("canvasSize")),this.canvas.dataset.size=this.canvasSize,this.layer.dataset.size=this.canvasSize;const t=Math.round(this.MAX_CANVAS_SIZE/Number(localStorage.getItem("canvasSize")));document.querySelector(`.size_switcher--button-${t}x${t}`).classList.add("active")}else document.querySelector(`.size_switcher--button-${this.MAX_CANVAS_SIZE}x${this.MAX_CANVAS_SIZE}`).classList.add("active"),this.canvasSize=1,this.canvas.dataset.size="1",this.layer.dataset.size="1";return this.canvasSize}async getFromStorage(){return await this.getCanvasData(),this.getColor(),this.getCanvasSize(),this.getFrameStack()}}(y,C,D,E,512);R.getFromStorage().then(async t=>{P.frameStack=t;const e=document.createDocumentFragment();t.forEach((t,a)=>{const s=new c(a,t.dataURL,l);e.appendChild(s.createFrame())}),M.appendChild(e),p(document.querySelector(".frame_0"));const a=P.getActiveFrame();P.clearMainCanvas(),P.changeCanvasIMG(P.frameStack[a].dataURL,y)}),i(k,"cursor-pencil"),document.querySelector(".color--input-red").addEventListener("click",t=>{F.getDefaultColor(t),R.setColor()}),document.querySelector(".color--input-blue").addEventListener("click",t=>{F.getDefaultColor(t),R.setColor()}),E.addEventListener("click",t=>{F.getPreviousColor(t),R.setColor()}),D.addEventListener("input",()=>{F.changePrevColor(),R.setColor()}),D.addEventListener("click",t=>{F.setPrevColor(t.target.value),R.setColor()}),L.addEventListener("click",()=>{i(L,"cursor-bucket"),z.disableLayer()}),w.addEventListener("click",()=>{i(w,"cursor-grab"),z.disableLayer()}),k.addEventListener("click",()=>{i(k,"cursor-pencil"),z.disableLayer()}),b.addEventListener("click",()=>{i(b,"cursor-eraser"),z.activeLayer(),z.disableLayer()}),_.addEventListener("click",()=>{i(_,"cursor-pencil"),z.activeLayer()}),y.addEventListener("click",t=>{if(L.classList.contains("active")){const e=new o(y),a={x:Math.round(t.offsetX),y:Math.round(t.offsetY)},s=e.getPixel(a);e.floodFill(a,s,function(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),255]}(D.value)),e.fillColor()}w.classList.contains("active")&&(r(t),R.setColor()),P.changeFrameIMG(P.getActiveFrame(),y.toDataURL()),R.setFrameStack(P.frameStack)}),y.addEventListener("mousedown",t=>{k.classList.contains("active")&&A.setInitialCoordinate(t),b.classList.contains("active")&&q.setInitialCoordinate(t)}),y.addEventListener("mousemove",t=>{k.classList.contains("active")&&A.draw(t),b.classList.contains("active")&&q.draw(t)}),y.addEventListener("mouseup",()=>{k.classList.contains("active")&&A.doneDraw(),b.classList.contains("active")&&q.doneDraw(),R.setCanvasData()}),y.addEventListener("mouseout",()=>{k.classList.contains("active")&&A.doneDraw(),b.classList.contains("active")&&q.doneDraw(),R.setCanvasData()}),C.addEventListener("mousedown",t=>{_.classList.contains("active")&&z.setInitialCoordinate(t)}),C.addEventListener("mousemove",t=>{_.classList.contains("active")&&z.draw(t)}),C.addEventListener("mouseup",()=>{_.classList.contains("active")&&(z.doneDraw(),P.changeFrameIMG(0,y.toDataURL())),R.setCanvasData()}),C.addEventListener("mouseout",()=>{_.classList.contains("active")&&(z.doneDraw(),P.changeFrameIMG(0,y.toDataURL())),R.setCanvasData()}),document.addEventListener("keydown",t=>{switch(t.code){case"KeyB":i(L,"cursor-bucket");break;case"KeyC":i(w,"cursor-grab");break;case"KeyP":i(k,"cursor-pencil")}}),x.addEventListener("click",t=>{"BUTTON"===t.target.tagName?(n(t.target),R.setCanvasSize()):"IMG"===t.target.tagName&&(n(t.target.parentNode),R.setCanvasSize())}),M.addEventListener("mousedown",t=>{let e;if(t.target.closest(".frames_list--item")&&(e=t.target.closest(".frames_list--item"),!e.classList.contains("active_frame"))){p(e);const t=P.getActiveFrame();P.clearMainCanvas(),P.changeCanvasIMG(P.frameStack[t].dataURL,y)}if(t.target.closest(".buttons--item")){let a=P.getActiveFrame();e=t.target.closest(".buttons--item");const s=new S(a,P.frameStack,p);switch(e.dataset.type){case"delete":s.deleteFrame(P.getActiveFrame()),a=P.getActiveFrame(),P.clearMainCanvas(),P.changeCanvasIMG(P.frameStack[a].dataURL,y);break;case"copy":s.duplicateFrame()}}const a=P.getActiveFrame();new S(a,P.frameStack,p).addEvents(),R.setFrameStack(P.frameStack)}),I.addEventListener("click",async()=>{P.clearMainCanvas();const t=new c(P.frameStack.length,y.toDataURL(),l);M.appendChild(t.createFrame()),P.addFrameData({dataURL:y.toDataURL()}),p(document.querySelector(`.frame_${P.frameStack.length-1}`)),R.setFrameStack(P.frameStack)})}]);
//# sourceMappingURL=app.bundle.js.map